# Active Files in Carole's Reef Project
# All needed files for the player experience are listed here.
Status: Current active runtime list (see FileStructure.txt for future plan).

## Data Persistence Architecture

### Overview
The application is moving toward a centralized persistence model where:
1. GameState is the runtime source of truth for all active gameplay state
2. localStorage is the primary persistence layer for resuming play after reloads
3. Backup/Restore provides durable, shareable JSON files for long-term saves

### Key Components
- **Runtime State (GameState)**:
  - GameState is intended to hold all live gameplay state (fish/bio, tank, settings, progress)
  - UI updates should flow from GameState changes
  - FishManager is a legacy in-memory adapter and is expected to be phased out
  - Future plans include bio inventory and decor traits living under GameState

- **Controlled Persistence (localStorage)**:
  - `localStorageManager` is the single interface for localStorage reads/writes
  - GameState saves snapshot data to localStorage (debounced where possible)
  - Data validation occurs before persistence

- **Backup/Restore (JSON files)**:
  - `BackupManager` exports/imports JSON for offline persistence and sharing
  - Restore can merge back into the current session (e.g., bio inventory)
  - Backup/Restore should always validate and normalize data

### Important Notes
- Direct `localStorage` access is deprecated
- All localStorage access should go through `storageManager`
- Validation is required before saving or restoring data
- GameState is the runtime source of truth; localStorage is for resume-on-load
- Backup/Restore is for durable, portable saves (not the live source of truth)

## Core Application
- index.html - Main HTML entry point
   * REQUIRES: /favicon.ico, src/styles/style.css, src/main.ts
   * USED-BY: (none - main entry point)
- src/main.ts - Main TypeScript entry point
   * REQUIRES: ./audio/audioManager.ts, ./config/gameConfig.ts, ./core/events.ts, ./legacy/runLegacyGame.ts, ./state/GameState.ts, ./utils/localStorageManager.ts
   * USED-BY: /index.html
- src/core/events.ts - Event bus implementation
   * REQUIRES: (none)
   * USED-BY: src/main.ts, src/audio/audioManager.ts

## Audio
- src/audio/audioManager.ts - Audio management
   * REQUIRES: howler (npm), ../core/events.ts, ./sfx.ts
   * USED-BY: src/main.ts
- src/audio/sfx.ts - Sound effects configuration
   * REQUIRES: /audio/eat.mp3 (missing), /audio/click.mp3 (missing)
   * USED-BY: src/audio/audioManager.ts

## Legacy Game Code
- src/legacy/runLegacyGame.ts - Main legacy game loop
   * REQUIRES: src/creatures/FishManager.ts, src/entities/decor.ts, src/entities/fish.ts, src/render/background.ts, src/render/decorRenderer.ts, src/state/GameState.ts, src/ui/BackupManagerUI.ts, src/utils/audio.ts, src/utils/localStorageManager.ts, ./bubbles.ts, ./fishCardUI.ts, ./inputHandlers.ts, ./pellets.ts, ./renderer.ts, ./uiControls.ts, src/ui/FishCollection.ts (dynamic)
   * USED-BY: src/main.ts
   * PERSISTENCE: Updates in-memory data only
- src/legacy/bubbles.ts - Bubble simulation for legacy renderer
   * REQUIRES: (none)
   * USED-BY: src/legacy/runLegacyGame.ts
- src/legacy/fishCardUI.ts - Legacy FishCard controller and bindings
   * REQUIRES: src/ui/FishCard.ts, src/ui/toast.ts, src/utils/fishStorage.ts
   * USED-BY: src/legacy/runLegacyGame.ts, src/legacy/inputHandlers.ts
- src/legacy/inputHandlers.ts - Legacy input handling (mouse/keys)
   * REQUIRES: src/entities/fish.ts, src/entities/decor.ts, src/legacy/fishCardUI.ts
   * USED-BY: src/legacy/runLegacyGame.ts
- src/legacy/pellets.ts - Legacy food pellet simulation/rendering helpers
   * REQUIRES: (none)
   * USED-BY: src/legacy/runLegacyGame.ts
- src/legacy/renderer.ts - Legacy render loop orchestration
   * REQUIRES: src/entities/fish.ts, src/entities/decor.ts, src/legacy/pellets.ts, src/legacy/bubbles.ts
   * USED-BY: src/legacy/runLegacyGame.ts
- src/legacy/uiControls.ts - Legacy UI wiring for menus and buttons
   * REQUIRES: src/ui/toast.ts, src/ui/FishCollection.ts
   * USED-BY: src/legacy/runLegacyGame.ts

## Entities
 - src/entities/creature.ts - Base creature type definitions and interfaces
   * REQUIRES: (none)
   * USED-BY: src/state/types.ts
 - src/entities/fish.ts - Fish entity logic and behavior
   * REQUIRES: src/state/GameState.ts, src/render/eyeRenderer.ts, src/ui/FishCollection.ts (dynamic), src/ui/toast.ts, src/utils/audio.ts
   * USED-BY: src/legacy/runLegacyGame.ts
   * PERSISTENCE: Updates in-memory data only
 - src/entities/decor.ts - Decorations and environment
   * REQUIRES: src/state/types.ts
   * USED-BY: src/legacy/runLegacyGame.ts

## Creatures
 - src/creatures/FishManager.ts - In-memory fish collection manager (legacy adapter)
   * REQUIRES: src/utils/gameDataValidator.ts, src/utils/localStorageManager.ts
   * USED-BY: src/legacy/runLegacyGame.ts, src/utils/BackupManager.ts
 - src/creatures/types.ts - Creature type definitions used by UI
   * REQUIRES: (none)
   * USED-BY: src/ui/FishCard.ts

## UI Components
- src/ui/FishCollection.ts - Manages the fish collection UI
  * REQUIRES: src/state/GameState.ts, src/utils/fishStorage.ts, src/utils/gameDataValidator.ts, src/utils/localStorageManager.ts, ./FishCard.ts, ./toast.ts
  * USED-BY: src/entities/fish.ts (dynamic), src/legacy/runLegacyGame.ts (dynamic)
- src/ui/FishCard.ts - Displays individual fish cards
  * REQUIRES: src/creatures/types.ts
  * USED-BY: src/ui/FishCollection.ts
- src/ui/BackupManagerUI.ts - Backup/restore UI
  * REQUIRES: src/utils/BackupManager.ts, ./toast.ts
  * USED-BY: src/legacy/runLegacyGame.ts
  * NOTES: Restore dialog includes options to keep tank fish, restore tank fish, and restore tank layout
- src/ui/toast.ts - Toast notification system
  * REQUIRES: (none)
  * USED-BY: src/ui/FishCollection.ts, src/ui/FishCard.ts, src/ui/BackupManagerUI.ts, src/ui/controls/spawnToTank.ts, src/entities/fish.ts, src/legacy/uiControls.ts
- src/ui/controls/spawnToTank.ts - Spawn-to-tank UI control (planned; not wired yet)
  * REQUIRES: src/ui/FishCollection.ts, src/ui/toast.ts
  * USED-BY: (none - planned)

## Rendering
- src/render/background.ts - Background rendering
  * REQUIRES: ../config/themes.ts, ../config/backgrounds.ts
  * USED-BY: src/legacy/runLegacyGame.ts
- src/render/decorRenderer.ts - Decoration rendering
  * REQUIRES: src/state/types.ts
  * USED-BY: src/legacy/runLegacyGame.ts
  * NOTES: Debug decor radius overlay toggled by settings.debugDecorRadius
- src/render/eyeRenderer.ts - Eye drawing helpers (species-agnostic)
  * REQUIRES: (none)
  * USED-BY: src/entities/fish.ts

## Configuration
- src/config/gameConfig.ts - Game title/version/config values
  * REQUIRES: (none)
  * USED-BY: src/main.ts
- src/config/backgrounds.ts - Background configurations
  * REQUIRES: (none)
  * USED-BY: src/render/background.ts
- src/config/themes.ts - Theme configurations
  * REQUIRES: (none)
  * USED-BY: src/render/background.ts

## Utilities
- src/utils/localStorageManager.ts - Centralized localStorage management
   * REQUIRES: (none)
   * USED-BY: src/main.ts, src/creatures/FishManager.ts, src/state/GameState.ts, src/ui/FishCollection.ts, src/utils/fishStorage.ts, src/utils/BackupManager.ts
   * PERSISTENCE: Single point of contact for all localStorage operations
   * Manages data versioning and migration
   * Handles serialization/deserialization
- src/utils/BackupManager.ts - Backup and restore functionality
   * REQUIRES: ./gameDataValidator.ts, ./localStorageManager.ts, src/creatures/FishManager.ts, src/state/GameState.ts
   * USED-BY: src/ui/BackupManagerUI.ts
   * PERSISTENCE: Handles explicit save operations with validation
   * Validates data before persisting to localStorage
- src/utils/gameDataValidator.ts - Validation and migration utilities
   * REQUIRES: ./localStorageManager.ts (types only)
   * USED-BY: src/utils/localStorageManager.ts, src/utils/BackupManager.ts, src/creatures/FishManager.ts, src/utils/fishStorage.ts, src/ui/FishCollection.ts
- src/utils/fishStorage.ts - Fish storage utilities (collection helpers)
   * REQUIRES: src/state/GameState.ts
   * USED-BY: src/ui/FishCollection.ts
   * PERSISTENCE: Updates GameState; persistence handled by GameState/localStorageManager
- src/utils/audio.ts - Audio utilities
   * REQUIRES: howler (npm)
   * USED-BY: src/legacy/runLegacyGame.ts, src/entities/fish.ts

## State
- src/state/GameState.ts - Central runtime state container
  * REQUIRES: src/utils/localStorageManager.ts
  * USED-BY: src/main.ts, src/entities/fish.ts, src/ui/FishCollection.ts, src/utils/fishStorage.ts, src/utils/BackupManager.ts, src/legacy/runLegacyGame.ts, src/legacy/fishCardUI.ts
- src/state/types.ts - Shared state types
  * REQUIRES: src/entities/creature.ts
  * USED-BY: src/entities/decor.ts, src/render/decorRenderer.ts

## Styles
- src/styles/style.css - Main stylesheet
  * REQUIRES: (none)
  * USED-BY: /index.html

## Public Assets
- public/favicon.ico - Website favicon
- public/audio/born.mp3 - Sound played when a new fish is born
- public/audio/caroles_reef_bkgd_music_track_01.mp3 - Background music track 1
- public/audio/caroles_reef_bkgd_music_track_02.mp3 - Background music track 2
- public/audio/dead.mp3 - Sound played when a fish dies
- public/audio/release.mp3 - Sound played when a fish is released
- public/audio/yippie.ogg - Sound effect for happy events
- public/images/Caroles_Reef-01.png - Game logo/art 1
- public/images/Caroles_Reef-02.png - Game logo/art 2
- public/images/Caroles_Reef-03.png - Game logo/art 3
- public/images/tank_background01.png - Main tank background image
